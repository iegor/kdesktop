<chapter id="modem-tricks">
<title
>Тонкости работы с модемом</title>

<para
>Этот раздел предназначен для того, чтобы дать представление об искусстве работы с модемом. Все команды, которые здесь описываются, относятся к стандарту Hayes AT и к стандартному Hayes-совместимому модему. Однако не все модемы одинаковы, и ваш случай может отличаться от изложенного.</para>

<sect1 id="modem-sessions">
<title
>Сеанс связи с модемом</title>

<para
>В модемном сеансе вы работаете с модемом непосредственно. Вы набираете команды -- модем отвечает. Для начала сеанса связи с модемом нажмите на кнопку <guibutton
>Настройка</guibutton
>. В открывшемся диалоге перейдите на вкладку <guilabel
>Модем</guilabel
> и нажмите кнопку <guibutton
>Терминал</guibutton
> . Откроется окно интерактивной настройки модема. Наберите команду <userinput
><command
>ATZ</command
></userinput
> (она сбрасывает установки модема). Модем должен отозваться и ответить OK. Используйте <menuchoice
><guimenu
>Файл</guimenu
><guimenuitem
>Закрыть</guimenuitem
></menuchoice
> для завершения сеанса.</para>

</sect1>

<sect1 id="modem-profiles">
<title
>Схемы настроек модема</title>
					
<para
>Вы можете захотеть сохранить различные схемы настроек модема, а не вводить команды заново при каждом соединении. Это можно осуществить, записав их в память модема, и именно для этого вам понадобится работать непосредственно в сеансе связи с модемом. У модема может быть несколько сохраненных схем под номерами 0, 1 и т.д. Командой <command
>AT&amp;V</command
> вы можете просмотреть их все. Обычно схема по умолчанию -- это 0 (ее можно изменить командой <command
>AT&amp;Y</command
>). Текущая схема, с которой работает модем, называется <quote
>активной</quote
>.</para>

<para
>Когда вы меняете настройку, активная схема изменяется. Команда <command
>ATZ</command
> сбрасывает настройки модема и восстанавливает схему настроек модема по умолчанию (#0), при этом не сохраняются сделанные вами изменения. Для сохранения изменений загрузите схему, которую вы хотите изменить, командой <command
>ATZ<replaceable
>n</replaceable
></command
> (где <replaceable
>n</replaceable
> -- номер схемы). Сделайте необходимые изменения, а затем сохраните ее командой <command
>AT&amp;W<replaceable
>n</replaceable
></command
>. Чтобы использовать нужную схему, измените строку инициализации модема (<guibutton
>Настройка</guibutton
> <guilabel
>Модем</guilabel
> <guibutton
>Команды модема</guibutton
> <guilabel
>Строка инициализации</guilabel
>). К примеру, команда <command
>ATZ1</command
> сбросит настройки модема и загрузит сохраненную схему #1.</para>

<para
>Если вы хотите сбросить установки модема в некоторое начальное состояние, выполните команду <command
>AT&amp;F&amp;W</command
>, которая восстановит заводские настройки модема и сохранит их в качестве схемы по умолчанию.</para>

<para
>Примеры изменения схемы модема см. в следующем разделе.</para>

</sect1>

<sect1 id="modem-hangup">
<title
>Как заставить модем повесить трубку</title>

<para
>Может случиться так, что модем никак не хочет вешать трубку. Это чаще всего происходит из-за несоответствия настроек &kppp; и модема. У стандартного модема есть два метода повесить трубку: <link linkend="hangup-command-method"
>Командный</link
> и <link linkend="hangup-dtr-method"
><acronym
>DTR</acronym
></link
>. В командном методе модему отправляется ESC-последовательность, которая переводит модем в командный режим, а затем выполняется команда повесить трубку (<command
>ATH</command
>).</para>

<para
>Если вы настраиваете демон <application
>ppp</application
> вручную, не используя &kppp;, чаще всего имеет смысл использовать командный метод для завершения терминального сеанса и запуска демона <application
>ppp</application
>. В других случаях более подходит метод <acronym
>DTR</acronym
>, так как он проще.</para>

<sect2 id="hangup-dtr-method">
<title
>Метод <acronym
>DTR</acronym
> (<command
>AT&amp;Dn</command
>)</title>

<para
>В методе <acronym
>DTR</acronym
>модем вешает трубку, как только &kppp; завершает использование модема. Если в сеансе связи с модемом вы опрашиваете модем командой <command
>AT&amp;V</command
> и в настройках активной схемы видите <command
>&amp;D0</command
>, это значит, что метод <acronym
>DTR</acronym
> отключен. Чтобы включить метод <acronym
>DTR</acronym
>, нажмите на кнопку <guibutton
>Терминал</guibutton
> для начала сеанса связи с модемом, а затем наберите:</para>

<screen
><userinput
><command
>ATZ</command
></userinput
> <lineannotation
># сбросить установки в схему по умолчанию</lineannotation>
<userinput
><command
>AT&amp;D2</command
></userinput
>  <lineannotation
># Установить состояние Повесить трубку при выходе из DTR</lineannotation>
<userinput
><command
>AT&amp;W</command
></userinput
>  <lineannotation
># Записать в схему по умолчанию</lineannotation
>
</screen>

<sect3>
<title
>Как работает метод <acronym
>DTR</acronym
></title>

<para
>Всякий раз, когда сигнал Data Terminal Ready (<acronym
>DTR</acronym
>) на линии между компьютером и модемом возрастает выше определенного предела, модем вешает трубку. Когда &kppp; открывает последовательный порт, сигнал <acronym
>DTR</acronym
> понижается, и на внешнем модеме вы можете видеть, как зажигается лампочка <acronym
>DTR</acronym
> (или <acronym
>TR</acronym
>). Когда лампочка <acronym
>TR</acronym
> гаснет, поскольку &kppp; закрыл последовательный порт (или по еще более худшей причине), модем вешает трубку.</para>
</sect3>

</sect2>

<sect2 id="hangup-command-method">
<title
>Командный метод</title>

<para
>Модем, находящийся в режиме соединения, можно также заставить повесить трубку (если <command
>AT&amp;D<replaceable
>n</replaceable
></command
> <replaceable
>n</replaceable
> не равно <returnvalue
>2</returnvalue
>), переведя его в командный режим и отправив ему команду на выполнение. Чтобы корректно повесить трубку, откройте сеанс связи с модемом и установите короткую задержку, например:</para>

<screen
><userinput
><command
>ATZ</command
></userinput>
<userinput
><command
>ATS12=5</command
></userinput>
<userinput
><command
>AT&amp;W</command
></userinput
>
</screen>

<para
>Используйте ползунок <guilabel
>Защитный интервал</guilabel
> в разделе Команды модема для установки значения регистра <varname
>S12</varname
> равным <returnvalue
>5</returnvalue
>. После этого модем будет вешать трубку корректно.</para>

<sect3>
<title
>Как работает командный метод</title>

<para
>Когда локальный модем подключен к удаленному модему, он находится в режиме соединения (<quote
>connect</quote
>) и передает все получаемые им символы удаленному модему. Для того, чтобы модем воспринял символы как команду себе, его нужно перевести в командный режим. Это осуществляется ESC-кодом.</para>

<para
>ESC-код - это три сигнала, длительность которых задается регистром <varname
>S12</varname
> (в пятидесятых долях секунды).</para>

<itemizedlist>
<listitem>
<para
>отсутствие сигнала в течение времени дольше, чем <varname
>S12</varname
>/50 сек</para>
</listitem>
<listitem>
<para
>три подряд символа ESC (который задаётся в регистре <varname
>S2</varname
>, значение по умолчанию -- <quote
>+</quote
>), повторенные с интервалами менее <varname
>S12</varname
>/50 с каждый.</para>
</listitem>
<listitem>
<para
>отсутствие сигнала в течение времени дольше, чем <varname
>S12</varname
>/50 сек</para>
</listitem>
</itemizedlist>

<para
>Как только модем войдет в командный режим, вы можете отправлять ему команды. Для того, чтобы повесить трубку, отправьте команду <command
>ATH</command
>. ЕSC-коды и команда модему повесить трубку, используемые в &kppp;, указываются в диалоге <link linkend="modem-commands"
><guilabel
>Команды модема</guilabel
></link
>. Они должны соответствовать вашему модему.</para>

</sect3>
</sect2>
</sect1>

<sect1 id="tone-dialing-speedup">
<title
>Как ускорить режим тонального набора номера</title>

<para
>В тональном режиме время набора задается регистром <varname
>S11</varname
>. В нем записывается длительность (в сотых долях секунды) отправки каждого тонального сигнала во время дозвона. Значением по умолчанию, как правило, является 95 (почти секунда). Быстрота набора номера зависит от качества телефонного коммутатора на вашей телефонной станции. Минимальное значение - 50, почти в два раза быстрее, и часто оно срабатывает. </para>

<screen
><userinput
><command
>ATZ</command
></userinput
>        <lineannotation
># восстановить установки схемы по умолчанию</lineannotation>
<userinput
><command
>ATS11=50</command
></userinput
>   <lineannotation
># самый быстрый дозвон (используйте большие значения, если возникнут проблемы)</lineannotation>
<userinput
><command
>AT&amp;W</command
></userinput
>   <lineannotation
># записать в схему по умолчанию</lineannotation
>
</screen>

</sect1>
</chapter>
